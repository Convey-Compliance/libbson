import os ;
local BOOST_ROOT_PATH = [ os.environ BOOST_ROOT ] ;

project bson_main 
     : requirements <include>./bson
                    <include>../bson
                    <include>../yajl
                    <include>../
                    <include>$(BOOST_ROOT_PATH)

                    <define>bson_shared_EXPORTS
                    <define>BSON_COMPILATION                      
 #                   <target-os>windows:<toolset>gcc <define>WIN_MINGW_GCC_BOOST_BUILD                  
     : source-location ../
     : build-dir ./build.dir ;

SOURCES_FILES = 
	bson/bcon.c
	bson/bson.c
	bson/bson-clock.c
	bson/bson-context.c
	bson/bson-error.c
	bson/bson-iter.c
	bson/bson-json.c
	bson/bson-keys.c
	bson/bson-md5.c
	bson/bson-memory.c
	bson/bson-oid.c
	bson/bson-reader.c
	bson/bson-string.c
	bson/bson-utf8.c
	bson/bson-writer.c
	yajl/yajl_alloc.c
	yajl/yajl_buf.c
	yajl/yajl.c
	yajl/yajl_encode.c
	yajl/yajl_gen.c
	yajl/yajl_lex.c
	yajl/yajl_parser.c
	yajl/yajl_tree.c
	yajl/yajl_version.c
;

lib libbson-1.0 : $(SOURCES_FILES) : <toolset>msvc
                                  <cxxflags>/TC
                                  <cxxflags>/RTC1
                                  <linkflags>/DEFAULTLIB:Ws2_32.lib
                                  <def-file>build/win32/libbson.def ;

lib libbson-1.0 : $(SOURCES_FILES) : <toolset>gcc									 
                                  <cxxflags>-std=gnu99  #c99                                  
                                  <linkflags>-lws2_32
                                  <linkflags>-lkernel32
                                  <linkflags>-lpthread
                                  <def-file>build/win32/libbson.def ;